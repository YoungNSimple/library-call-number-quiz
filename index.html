<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œê´€ ì •ë¦¬ ë§ˆìŠ¤í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #fdf2f8; }
        .btn-press:active { transform: scale(0.95); }
        .tab-btn { transition: all 0.2s; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- ë°ì´í„°: í•œê¸€ ìëª¨ ë° ê·œì¹™ ---
        const KOREAN_CONSONANTS = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
        const KOREAN_VOWELS = ['ã…','ã…','ã…‘','ã…’','ã…“','ã…”','ã…•','ã…–','ã…—','ã…˜','ã…™','ã…š','ã…›','ã…œ','ã…','ã…','ã…Ÿ','ã… ','ã…¡','ã…¢','ã…£'];

        const KDC_RULES = [
            { 
                title: "1ë‹¨ê³„: ì£¼ì œ ë²ˆí˜¸ (ë¶„ë¥˜ ê¸°í˜¸) - ì‹­ì§„ë²• ìˆœì„œ!", 
                color: "text-blue-600",
                explanation: "ì±…ì˜ ì£¼ì œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìˆ«ìì…ë‹ˆë‹¤. **ìˆ«ìê°€ ì‘ì„ìˆ˜ë¡** ë¨¼ì € ê½‚í˜€ì•¼ í•©ë‹ˆë‹¤. íŠ¹íˆ, ì†Œìˆ˜ì  ì´í•˜ì˜ ìˆ«ìëŠ” ì¼ë°˜ì ì¸ ì‹­ì§„ë²• ìˆœì„œ(ìˆ«ì í¬ê¸°)ëŒ€ë¡œ ë¹„êµí•´ì•¼ í•©ë‹ˆë‹¤.",
                examples: [
                    { title: "530.5 vs 530.49", note: "ì†Œìˆ˜ì  ì•„ë˜ '49'ê°€ '50'ë³´ë‹¤ ì‘ìœ¼ë¯€ë¡œ 530.49ê°€ ë¨¼ì € ì˜µë‹ˆë‹¤." },
                    { title: "813.1 vs 813.01", note: "0.01ì´ 0.1ë³´ë‹¤ ì‘ìœ¼ë¯€ë¡œ 813.01ì´ ë¨¼ì € ì˜µë‹ˆë‹¤." }
                ]
            },
            { 
                title: "2ë‹¨ê³„: ì €ì ë²ˆí˜¸ (ë„ì„œ ê¸°í˜¸) - í•œê¸€, ìˆ«ì, ì €ì‘ ê¸°í˜¸ ìˆœì„œ!", 
                color: "text-purple-600",
                explanation: "ë°°ì—´ ìˆœì„œ: 1) **ì €ìëª… í•œê¸€** (ê°€ë‚˜ë‹¤ ìˆœ) â†’ 2) **ì €ìëª… ë’¤ ìˆ«ì** (ì‘ì€ ìˆ˜ ìš°ì„ ) â†’ 3) **ì €ì‘ ê¸°í˜¸** (ì±… ì œëª©ì˜ ì²« ê¸€ì ê¸°í˜¸, ê°€ë‚˜ë‹¤ ìˆœ).",
                examples: [
                    { title: "ê°€294 vs ê°294", note: "ë¬´ë°›ì¹¨ 'ê°€'ê°€ 'ê°'(ã„± ë°›ì¹¨)ë³´ë‹¤ í•­ìƒ ë¨¼ì € ì˜µë‹ˆë‹¤." },
                    { title: "ë™6ê°€ vs ë™61ã„±", note: "ìˆ«ì '6'ì´ '61'ë³´ë‹¤ ì‘ìœ¼ë¯€ë¡œ ë™6ê°€(6)ê°€ ë¨¼ì € ì˜µë‹ˆë‹¤." }
                ]
            },
            { 
                title: "3ë‹¨ê³„: ê¶Œì°¨ ë° ë³µë³¸ ê¸°í˜¸ - ì‹œë¦¬ì¦ˆê°€ ë¨¼ì €!", 
                color: "text-red-600",
                explanation: "1) **ì‹œë¦¬ì¦ˆ(v.)**ê°€ **ë³µë³¸(c.)**ë³´ë‹¤ ë¨¼ì € ì˜¤ë©°, 2) ê·¸ ë‹¤ìŒì€ **ìˆ«ì(1, 2, 3...)** ìˆœì„œëŒ€ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.",
                examples: [
                    { title: "v.1 vs v.2", note: "1ê¶Œì´ 2ê¶Œë³´ë‹¤ ë¨¼ì € ì˜µë‹ˆë‹¤." },
                    { title: "v.1 vs c.1", note: "ê¶Œì°¨(v.)ê°€ ë³µë³¸(c.)ë³´ë‹¤ ë¨¼ì € ì˜¤ë„ë¡ ë°°ì—´í•©ë‹ˆë‹¤." }
                ]
            }
        ];

        // --- ë°ì´í„°: ê³ ë‚œì´ë„ í€´ì¦ˆ ---
        const QUIZ_CALL_NUMBERS = [
            [{class:"813.5",author:"ê°€300",vol:""}, {class:"813.5",author:"ê°„300",vol:""}, {class:"813.51",author:"ê°ˆ300",vol:""}],
            [{class:"500.1",author:"ë‚˜20",vol:"v.1"}, {class:"500.1",author:"ë‚˜20",vol:"c.1"}, {class:"500.01",author:"ë‚˜20",vol:"v.1"}],
            [{class:"630.01",author:"ìµœ100",vol:""}, {class:"630.001",author:"ìµœ099",vol:""}, {class:"630.01",author:"ìµœ099",vol:""}],
            [{class:"100",author:"ë°°100",vol:""}, {class:"100",author:"ë²¼050",vol:""}, {class:"100",author:"ë°°050",vol:""}],
            [{class:"911.3",author:"ë‹¬20",vol:""}, {class:"911.3",author:"ë‹¤10",vol:""}, {class:"911.3",author:"ë‹¨10",vol:""}],
            [{class:"700.5",author:"ì¥20",vol:"ã„±"}, {class:"700.4",author:"ì¥20",vol:""}, {class:"700.5",author:"ì¥20",vol:""}],
            [{class:"811",author:"ê°€30",vol:""}, {class:"811",author:"ê°¸30",vol:""}, {class:"811",author:"ê±°30",vol:""}],
            [{class:"800",author:"ì™œ20",vol:""}, {class:"800",author:"ì›”20",vol:""}, {class:"800",author:"ì™€20",vol:""}]
        ];

        // --- ë¡œì§: ì •ë ¬ ---
        const getSortKey = (item) => {
            const classNum = item.class ? parseFloat(item.class) : 0;
            let authorKey = ['', 0, ''];
            if (item.author) {
                const match = item.author.match(/^([ã„±-ã…ã…-ã…£ê°€-í£]+)?(\d+)?(.*)$/);
                if (match) {
                    authorKey = [match[1] || '', parseInt(match[2]) || 0, match[3] || ''];
                }
            }
            let volKey = [0, 0];
            if (item.vol) {
                const vMatch = item.vol.match(/v\.(\d+)/i);
                const cMatch = item.vol.match(/c\.(\d+)/i);
                if (vMatch) volKey = [1, parseInt(vMatch[1])];
                else if (cMatch) volKey = [2, parseInt(cMatch[1])];
            }
            return [classNum, ...authorKey, ...volKey];
        };

        const compareCallNumbers = (a, b) => {
            const keyA = getSortKey(a);
            const keyB = getSortKey(b);
            for (let i = 0; i < keyA.length; i++) {
                if (keyA[i] < keyB[i]) return -1;
                if (keyA[i] > keyB[i]) return 1;
            }
            return 0;
        };

        const getComparisonReason = (itemA, itemB) => {
            const keyA = getSortKey(itemA);
            const keyB = getSortKey(itemB);
            const types = ['ì£¼ì œ ë²ˆí˜¸', 'ì €ìëª… í•œê¸€', 'ì €ì ë²ˆí˜¸ ìˆ«ì', 'ì €ì‘ ê¸°í˜¸', 'ê¶Œ/ë³µë³¸ ì¢…ë¥˜', 'ê¶Œ/ë³µë³¸ ë²ˆí˜¸'];
            
            for (let i = 0; i < keyA.length; i++) {
                if (keyA[i] !== keyB[i]) {
                    const winner = keyA[i] < keyB[i] ? 'A' : 'B';
                    return `(${types[i]} ë¹„êµ: ${winner}ê°€ ë¨¼ì €)`;
                }
            }
            return "(ëª¨ë“  í•­ëª©ì´ ê°™ê±°ë‚˜ ìˆœì„œ êµ¬ë¶„ì´ ì–´ë µìŠµë‹ˆë‹¤)";
        };

        // --- ì»´í¬ë„ŒíŠ¸: ì•± ë©”ì¸ ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('compare');
            const [inputA, setInputA] = useState({ class: '', author: '', vol: '' });
            const [inputB, setInputB] = useState({ class: '', author: '', vol: '' });
            const [result, setResult] = useState({ msg: '', reason: '' });
            const [quiz, setQuiz] = useState([]);
            const [quizRes, setQuizRes] = useState(null);
            const [dragIdx, setDragIdx] = useState(null);

            const generateNewQuiz = useCallback(() => {
                const idx = Math.floor(Math.random() * QUIZ_CALL_NUMBERS.length);
                // í€´ì¦ˆ ë°ì´í„° ë³µì‚¬ ë° ID ìƒì„±
                setQuiz(QUIZ_CALL_NUMBERS[idx].map(item => ({ ...item, id: Math.random() })));
                setQuizRes(null);
            }, []);

            useEffect(() => { generateNewQuiz(); }, [generateNewQuiz]);

            const handleCompare = () => {
                if ((!inputA.class && !inputA.author && !inputA.vol) || (!inputB.class && !inputB.author && !inputB.vol)) {
                    setResult({ msg: 'âš ï¸ ì •ë³´ë¥¼ ë” ì…ë ¥í•´ì£¼ì„¸ìš”!', reason: '' });
                    return;
                }
                const r = compareCallNumbers(inputA, inputB);
                const reason = getComparisonReason(inputA, inputB);
                if (r < 0) setResult({ msg: 'ì±… A â†’ ì±… B ìˆœì„œë¡œ ê½‚ì•„ì£¼ì„¸ìš”.', reason });
                else if (r > 0) setResult({ msg: 'ì±… B â†’ ì±… A ìˆœì„œë¡œ ê½‚ì•„ì£¼ì„¸ìš”.', reason });
                else setResult({ msg: 'ìˆœì„œ ë™ì¼', reason });
            };

            const clearInputs = () => {
                setInputA({ class: '', author: '', vol: '' });
                setInputB({ class: '', author: '', vol: '' });
                setResult({ msg: '', reason: '' });
            };

            const onDragStart = (e, idx) => setDragIdx(idx);
            const onDragOver = (e, idx) => {
                e.preventDefault();
                if (dragIdx === null || dragIdx === idx) return;
                const newQuiz = [...quiz];
                const draggedItem = newQuiz[dragIdx];
                newQuiz.splice(dragIdx, 1);
                newQuiz.splice(idx, 0, draggedItem);
                setQuiz(newQuiz);
                setDragIdx(idx);
            };

            const handleSubmitQuiz = () => {
                const sorted = [...quiz].sort(compareCallNumbers);
                const isCorrect = quiz.every((item, i) => item.id === sorted[i].id);
                setQuizRes(isCorrect ? { ok: true, msg: 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ì™„ë²½í•´ìš”!' } : { ok: false, msg: 'âŒ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.', ans: sorted });
            };

            // --- UI ë Œë”ë§ ---
            const inputCls = "w-full p-3 text-lg font-medium border border-gray-300 rounded-lg focus:ring-2 focus:ring-fuchsia-400 focus:outline-none text-center placeholder-gray-400";
            const btnCls = "flex-1 py-3 rounded-xl font-bold shadow-sm btn-press transition";

            return (
                <div className="max-w-md mx-auto p-4 min-h-screen flex flex-col">
                    <header className="text-center mb-6">
                        <h1 className="text-3xl font-extrabold text-pink-600 mb-1 drop-shadow-sm">ğŸ“š ë„ì„œê´€ ë§ˆìŠ¤í„° âœ¨</h1>
                        <p className="text-gray-500 text-sm">ì‰½ê³  ì¬ë¯¸ìˆëŠ” ì²­êµ¬ê¸°í˜¸ ì •ë¦¬!</p>
                    </header>

                    <nav className="flex gap-2 mb-6">
                        <button onClick={() => setActiveTab('compare')} className={`${btnCls} ${activeTab === 'compare' ? 'bg-pink-500 text-white' : 'bg-white text-gray-600'}`}>ğŸ” ë¹„êµ</button>
                        <button onClick={() => setActiveTab('rules')} className={`${btnCls} ${activeTab === 'rules' ? 'bg-purple-500 text-white' : 'bg-white text-gray-600'}`}>ğŸ’¡ ê·œì¹™</button>
                        <button onClick={() => setActiveTab('quiz')} className={`${btnCls} ${activeTab === 'quiz' ? 'bg-indigo-500 text-white' : 'bg-white text-gray-600'}`}>ğŸ† í€´ì¦ˆ</button>
                    </nav>

                    <main className="bg-white rounded-2xl shadow-lg p-5 flex-1">
                        {activeTab === 'compare' && (
                            <section>
                                <h2 className="text-xl font-bold text-gray-800 border-b-2 border-pink-200 pb-2 mb-4">ë‘ ì±… ë¹„êµí•˜ê¸° ğŸ¤”</h2>
                                <div className="grid grid-cols-2 gap-3 mb-4">
                                    <div className="p-3 bg-pink-50 rounded-xl border-2 border-pink-200">
                                        <div className="font-bold text-pink-600 mb-2 text-center">ğŸ“˜ ì±… A</div>
                                        <input className={`${inputCls} mb-2`} placeholder="ì£¼ì œ (813.6)" value={inputA.class} onChange={e => setInputA({ ...inputA, class: e.target.value })} />
                                        <input className={`${inputCls} mb-2`} placeholder="ì €ì (ê¹€294)" value={inputA.author} onChange={e => setInputA({ ...inputA, author: e.target.value })} />
                                        <input className={inputCls} placeholder="ê¶Œì°¨ (v.1)" value={inputA.vol} onChange={e => setInputA({ ...inputA, vol: e.target.value })} />
                                    </div>
                                    <div className="p-3 bg-purple-50 rounded-xl border-2 border-purple-200">
                                        <div className="font-bold text-purple-600 mb-2 text-center">ğŸ“™ ì±… B</div>
                                        <input className={`${inputCls} mb-2`} placeholder="ì£¼ì œ (813.5)" value={inputB.class} onChange={e => setInputB({ ...inputB, class: e.target.value })} />
                                        <input className={`${inputCls} mb-2`} placeholder="ì €ì (ë‚˜15)" value={inputB.author} onChange={e => setInputB({ ...inputB, author: e.target.value })} />
                                        <input className={inputCls} placeholder="ê¶Œì°¨ (v.2)" value={inputB.vol} onChange={e => setInputB({ ...inputB, vol: e.target.value })} />
                                    </div>
                                </div>
                                <div className="flex gap-2 mb-4">
                                    <button onClick={handleCompare} className="flex-1 py-4 bg-pink-500 text-white rounded-xl font-bold text-lg shadow-md btn-press hover:bg-pink-600">âœ… ìˆœì„œ í™•ì¸!</button>
                                    <button onClick={clearInputs} className="px-4 py-4 bg-gray-200 text-gray-600 rounded-xl font-bold shadow-md btn-press">ğŸ§¹</button>
                                </div>
                                {result.msg && (
                                    <div className="p-4 bg-yellow-100 rounded-xl text-center border-2 border-yellow-300">
                                        <p className="text-2xl font-black text-gray-800 mb-1">{result.msg}</p>
                                        {result.reason && <p className="text-sm text-gray-600 font-medium">{result.reason}</p>}
                                    </div>
                                )}
                            </section>
                        )}

                        {activeTab === 'rules' && (
                            <section className="space-y-6">
                                <div className="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-500">
                                    <h3 className="font-bold text-lg text-blue-700 mb-2">ğŸ·ï¸ ì²­êµ¬ê¸°í˜¸ êµ¬ì¡°</h3>
                                    <p className="text-gray-700 font-medium">1ï¸âƒ£ <span className="text-red-600">813.6</span> (ì£¼ì œ/ë¶„ë¥˜) : ìˆ«ì í¬ê¸°<br/>2ï¸âƒ£ <span className="text-purple-600">ê¹€294</span> (ì €ì/ë„ì„œ) : í•œê¸€/ìˆ«ì</p>
                                </div>
                                <div className="bg-green-50 p-4 rounded-xl border-l-4 border-green-500">
                                    <h3 className="font-bold text-lg text-green-700 mb-2">ğŸ”¤ í•œê¸€ ìˆœì„œ (ê°€ë‚˜ë‹¤)</h3>
                                    <div className="flex flex-wrap gap-1 mb-2">
                                        {KOREAN_CONSONANTS.map((c, i) => <span key={i} className="bg-white px-2 py-1 rounded shadow-sm text-xs font-bold text-gray-700">{c}</span>)}
                                    </div>
                                    <div className="flex flex-wrap gap-1">
                                        {KOREAN_VOWELS.map((v, i) => <span key={i} className="bg-white px-2 py-1 rounded shadow-sm text-xs font-bold text-gray-700">{v}</span>)}
                                    </div>
                                    <p className="mt-2 text-sm text-gray-600 font-bold">* ë°›ì¹¨ ì—†ëŠ” ê¸€ìê°€ ë¨¼ì €!</p>
                                </div>
                                <div className="space-y-3">
                                    {KDC_RULES.map((rule, i) => (
                                        <div key={i} className="border rounded-xl p-3 shadow-sm bg-white">
                                            <h3 className={`font-bold ${rule.color} text-lg mb-1`}>{rule.title}</h3>
                                            <p className="text-sm text-gray-700 mb-2">{rule.explanation}</p>
                                            <div className="space-y-1">
                                                {rule.examples.map((ex, j) => (
                                                    <div key={j} className="bg-gray-50 p-2 rounded text-sm border border-gray-200">
                                                        <span className="font-bold text-gray-800 mr-1">{ex.title}</span>
                                                        <span className="text-gray-500 text-xs">({ex.note})</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </section>
                        )}

                        {activeTab === 'quiz' && (
                            <section className="space-y-4">
                                <h2 className="text-xl font-bold text-gray-800 text-center">ìˆœì„œëŒ€ë¡œ ë‚˜ì—´í•´ë³´ì„¸ìš”! ğŸ§©</h2>
                                <div className="space-y-2">
                                    {quiz.map((item, i) => (
                                        <div key={item.id} draggable onDragStart={(e) => onDragStart(e, i)} onDragOver={(e) => onDragOver(e, i)}
                                            className="flex items-center p-3 bg-white border-2 border-indigo-100 rounded-xl shadow-sm cursor-move active:bg-indigo-50">
                                            <div className="w-8 h-8 bg-indigo-500 text-white rounded-full flex items-center justify-center font-bold mr-3 shrink-0 shadow-sm">{i + 1}</div>
                                            <div className="font-mono text-lg leading-tight flex-1">
                                                <span className="text-blue-600 font-bold mr-1">{item.class}</span>
                                                <span className="text-gray-800 mr-1">{item.author}</span>
                                                <span className="text-red-500 text-sm">{item.vol}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-2 mt-4">
                                    <button onClick={generateNewQuiz} className="flex-1 py-3 bg-gray-200 rounded-xl font-bold text-gray-600 btn-press hover:bg-gray-300">ğŸ”„ ìƒˆ ë¬¸ì œ</button>
                                    <button onClick={handleSubmitQuiz} className="flex-1 py-3 bg-indigo-500 text-white rounded-xl font-bold shadow-md btn-press hover:bg-indigo-600">ğŸŒŸ ì •ë‹µ í™•ì¸!</button>
                                </div>
                                {quizRes && (
                                    <div className={`p-4 rounded-xl text-center border-2 mt-4 ${quizRes.ok ? 'bg-green-100 border-green-400' : 'bg-red-100 border-red-400'}`}>
                                        <p className={`text-xl font-bold mb-2 ${quizRes.ok ? 'text-green-700' : 'text-red-700'}`}>{quizRes.msg}</p>
                                        {!quizRes.ok && (
                                            <div className="text-left text-sm bg-white p-3 rounded-lg mt-2 border">
                                                <div className="font-bold text-red-500 mb-1">ì •ë‹µ ìˆœì„œ:</div>
                                                {quizRes.ans.map((it, idx) => (
                                                    <div key={idx} className="font-mono border-b last:border-0 py-1">
                                                        {idx + 1}. {it.class} / {it.author} {it.vol}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}
                            </section>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
