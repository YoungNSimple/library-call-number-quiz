<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œê°€ ì •ë¦¬ ë§ˆìŠ¤í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #fff1f2; }
        .btn-press:active { transform: scale(0.95); }
        .tab-btn { transition: all 0.2s; }
        /* ëª¨ë°”ì¼ í„°ì¹˜ ë“œë˜ê·¸ ìŠ¤íƒ€ì¼ */
        .touch-action-none { touch-action: none; } 
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- ë°ì´í„° ---
        const KOREAN_CONSONANTS = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
        const KOREAN_VOWELS = ['ã…','ã…','ã…‘','ã…’','ã…“','ã…”','ã…•','ã…–','ã…—','ã…˜','ã…™','ã…š','ã…›','ã…œ','ã…','ã…','ã…Ÿ','ã… ','ã…¡','ã…¢','ã…£'];

        const KDC_RULES = [
            { 
                title: "1ë‹¨ê³„: ì£¼ì œ ë²ˆí˜¸ (ë¶„ë¥˜ ê¸°í˜¸) - ì‹­ì§„ë²•!", 
                color: "text-blue-600",
                explanation: "ìˆ«ìê°€ ì‘ì„ìˆ˜ë¡ ë¨¼ì €ì…ë‹ˆë‹¤. ì†Œìˆ˜ì ì€ ìë¦¿ìˆ˜ë³„ë¡œ ë¹„êµí•˜ì„¸ìš”.",
                examples: [
                    { title: "530.5 vs 530.49", note: "49ê°€ 50ë³´ë‹¤ ì‘ì•„ì„œ 530.49ê°€ ë¨¼ì €!" },
                    { title: "800 vs 800.01", note: "800ì´ ê°€ì¥ ë¨¼ì €, ê·¸ ë’¤ì— ì†Œìˆ˜ì ." }
                ]
            },
            { 
                title: "2ë‹¨ê³„: ì €ì ê¸°í˜¸ - í•œê¸€ > ìˆ«ì > ê¸°í˜¸", 
                color: "text-purple-600",
                explanation: "í•œê¸€(ê°€ë‚˜ë‹¤) â†’ ìˆ«ì(í•œ ìë¦¬ì”© ë¹„êµ) ìˆœì„œì…ë‹ˆë‹¤. **100ì´ 2ë³´ë‹¤ ë¨¼ì € ì˜µë‹ˆë‹¤!** (1 < 2)",
                examples: [
                    { title: "ì´100 vs ì´2", note: "1ë¡œ ì‹œì‘í•˜ëŠ” 100ì´ ë¨¼ì €!" },
                    { title: "ê°€ vs ê°", note: "ë°›ì¹¨ ì—†ëŠ” 'ê°€'ê°€ ë¨¼ì €!" }
                ]
            },
            { 
                title: "3ë‹¨ê³„: ë¶€ì°¨ì  ê¸°í˜¸ - vê°€ cë³´ë‹¤ ë¨¼ì €!", 
                color: "text-red-600",
                explanation: "ê¶Œì°¨(v) > ë³µë³¸(c) ìˆœì„œì…ë‹ˆë‹¤. **ê¶Œì°¨ ìˆ«ìëŠ” ì¼ë°˜ ìˆ«ì í¬ê¸°ëŒ€ë¡œ(1 < 2 < 10)** ì •ë ¬í•©ë‹ˆë‹¤.",
                examples: [
                    { title: "v.2 vs v.10", note: "2ê°€ 10ë³´ë‹¤ ì‘ìœ¼ë¯€ë¡œ v.2ê°€ ë¨¼ì €!" },
                    { title: "v.1 vs c.1", note: "ê¶Œì°¨(v)ê°€ ë³µë³¸(c)ë³´ë‹¤ ë¨¼ì €!" }
                ]
            }
        ];

        const QUIZ_CALL_NUMBERS = [
            [{class:"900",author:"ì´100",vol:""}, {class:"900",author:"ì´2",vol:""}, {class:"900",author:"ì´20",vol:""}],
            [{class:"813.6",author:"ê°€30",vol:""}, {class:"813.6",author:"ê°„30",vol:""}, {class:"813.6",author:"ê°30",vol:""}], 
            [{class:"800",author:"ì‹¸20",vol:""}, {class:"800",author:"ì‚¬20",vol:""}, {class:"800",author:"ì‚­20",vol:""}],
            [{class:"811",author:"ìœ„10",vol:""}, {class:"811",author:"ì™œ10",vol:""}, {class:"811",author:"ì™¸10",vol:""}],
            [{class:"500.5",author:"ê¹€1",vol:""}, {class:"500.05",author:"ê¹€1",vol:""}, {class:"500.1",author:"ê¹€1",vol:""}],
            [{class:"813.6",author:"ë°•10",vol:"c.1"}, {class:"813.6",author:"ë°•10",vol:"v.1"}, {class:"813.59",author:"ë°•10",vol:"v.1"}],
            [{class:"100",author:"ì˜ˆ1",vol:""}, {class:"100",author:"ì—1",vol:""}, {class:"100",author:"ì™€1",vol:""}]
        ];

        // --- ë¡œì§ ---
        const compareDecimalLike = (aStr, bStr) => {
            const a = String(aStr);
            const b = String(bStr);
            if (a === b) return 0;
            return a < b ? -1 : 1;
        };

        const getSortKey = (item) => {
            const classNum = item.class ? item.class.trim() : "";
            let authorKey = ['', '', '']; 
            if (item.author) {
                const match = item.author.match(/^([ã„±-ã…ã…-ã…£ê°€-í£]+)?(\d+)?(.*)$/);
                if (match) authorKey = [match[1] || '', match[2] || '', match[3] || ''];
            }
            let volKey = [0, 0];
            if (item.vol) {
                const vMatch = item.vol.match(/v\.(\d+)/i);
                const cMatch = item.vol.match(/c\.(\d+)/i);
                if (vMatch) volKey = [1, parseInt(vMatch[1])];
                else if (cMatch) volKey = [2, parseInt(cMatch[1])];
            }
            return [classNum, ...authorKey, ...volKey];
        };

        const compareCallNumbers = (a, b) => {
            const keyA = getSortKey(a);
            const keyB = getSortKey(b);
            const types = ['ì£¼ì œ ë²ˆí˜¸', 'ì €ìëª… í•œê¸€', 'ì €ì ë²ˆí˜¸ ìˆ«ì', 'ì €ì‘ ê¸°í˜¸', 'ê¶Œ/ë³µë³¸ ì¢…ë¥˜', 'ê¶Œ/ë³µë³¸ ë²ˆí˜¸'];
            for (let i = 0; i < keyA.length; i++) {
                let valA = keyA[i];
                let valB = keyB[i];
                if (types[i] === 'ì£¼ì œ ë²ˆí˜¸' || types[i] === 'ì €ì ë²ˆí˜¸ ìˆ«ì') {
                    const res = compareDecimalLike(valA, valB);
                    if (res !== 0) return res;
                } else {
                    if (valA < valB) return -1;
                    if (valA > valB) return 1;
                }
            }
            return 0;
        };

        const getComparisonReason = (itemA, itemB) => {
            const keyA = getSortKey(itemA);
            const keyB = getSortKey(itemB);
            const types = ['ì£¼ì œ ë²ˆí˜¸', 'ì €ìëª… í•œê¸€', 'ì €ì ë²ˆí˜¸ ìˆ«ì', 'ì €ì‘ ê¸°í˜¸', 'ê¶Œ/ë³µë³¸ ì¢…ë¥˜', 'ê¶Œ/ë³µë³¸ ë²ˆí˜¸'];
            for (let i = 0; i < keyA.length; i++) {
                let valA = keyA[i];
                let valB = keyB[i];
                let diff = 0;
                if (types[i] === 'ì£¼ì œ ë²ˆí˜¸' || types[i] === 'ì €ì ë²ˆí˜¸ ìˆ«ì') diff = compareDecimalLike(valA, valB);
                else {
                    if (valA < valB) diff = -1;
                    if (valA > valB) diff = 1;
                }
                if (diff !== 0) {
                    const winner = diff === -1 ? 'A' : 'B';
                    let detail = (types[i] === 'ì €ì ë²ˆí˜¸ ìˆ«ì') ? ` (ì†Œìˆ˜ì ì‹ ë¹„êµ: ${valA} vs ${valB})` : '';
                    return `(${types[i]} ë¹„êµ${detail}: ${winner}ê°€ ë¨¼ì €)`;
                }
            }
            return "(ìˆœì„œ ë™ì¼)";
        };

        // --- ì»´í¬ë„ŒíŠ¸ ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('compare');
            const [inputA, setInputA] = useState({ class: '', author: '', vol: '' });
            const [inputB, setInputB] = useState({ class: '', author: '', vol: '' });
            const [result, setResult] = useState({ msg: '', reason: '' });
            const [quiz, setQuiz] = useState([]);
            const [quizRes, setQuizRes] = useState(null);

            const generateNewQuiz = useCallback(() => {
                const idx = Math.floor(Math.random() * QUIZ_CALL_NUMBERS.length);
                setQuiz(QUIZ_CALL_NUMBERS[idx].map(item => ({ ...item, id: Math.random() })));
                setQuizRes(null);
            }, []);

            useEffect(() => { generateNewQuiz(); }, [generateNewQuiz]);

            const handleCompare = () => {
                if ((!inputA.class && !inputA.author) || (!inputB.class && !inputB.author)) {
                    setResult({ msg: 'âš ï¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', reason: '' });
                    return;
                }
                const r = compareCallNumbers(inputA, inputB);
                const reason = getComparisonReason(inputA, inputB);
                let message = r < 0 ? 'A -> B ìˆœì„œ' : (r > 0 ? 'B -> A ìˆœì„œ' : 'ìˆœì„œ ë™ì¼');
                setResult({ msg: message, reason });
            };

            const clearInputs = () => {
                setInputA({ class: '', author: '', vol: '' });
                setInputB({ class: '', author: '', vol: '' });
                setResult({ msg: '', reason: '' });
            };

            // í•­ëª© ì´ë™ í•¨ìˆ˜ (ë²„íŠ¼ í´ë¦­ìš©)
            const moveItem = (index, direction) => {
                const newQuiz = [...quiz];
                const targetIndex = index + direction;
                if (targetIndex < 0 || targetIndex >= newQuiz.length) return; // ë²”ìœ„ ì²´í¬
                
                // ìœ„ì¹˜ êµí™˜
                const temp = newQuiz[index];
                newQuiz[index] = newQuiz[targetIndex];
                newQuiz[targetIndex] = temp;
                
                setQuiz(newQuiz);
            };

            const handleSubmitQuiz = () => {
                const sorted = [...quiz].sort(compareCallNumbers);
                const isCorrect = quiz.every((item, i) => item.id === sorted[i].id);
                setQuizRes(isCorrect ? { ok: true, msg: 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ì‹¤ë ¥ì´ ëŒ€ë‹¨í•´ìš”!' } : { ok: false, msg: 'âŒ ë•¡! ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”.', ans: sorted });
            };

            const inputCls = "w-full p-3 text-lg font-medium border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-rose-400 focus:border-rose-400 transition text-center placeholder-gray-400";
            const btnCls = "flex-1 py-3 rounded-xl font-bold shadow-sm btn-press transition duration-200";

            return (
                <div className="max-w-md mx-auto p-4 flex flex-col items-center w-full">
                    <header className="text-center mb-6 mt-4 w-full">
                        <h1 className="text-3xl font-extrabold text-rose-500 mb-1 drop-shadow-sm">ğŸ“š ì„œê°€ ì •ë¦¬ ë§ˆìŠ¤í„° ğŸ”¥</h1>
                        <p className="text-gray-500 text-sm font-medium">ì²­êµ¬ê¸°í˜¸ ì •ë¦¬, ì´ì œ ì–´ë µì§€ ì•Šì•„ìš”!</p>
                    </header>

                    <nav className="flex gap-2 mb-6 bg-white p-1 rounded-2xl shadow-sm w-full">
                        <button onClick={() => setActiveTab('compare')} className={`${btnCls} ${activeTab === 'compare' ? 'bg-rose-500 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100'}`}>ğŸ” ë¹„êµ</button>
                        <button onClick={() => setActiveTab('rules')} className={`${btnCls} ${activeTab === 'rules' ? 'bg-purple-600 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100'}`}>ğŸ’¡ ê·œì¹™</button>
                        <button onClick={() => setActiveTab('quiz')} className={`${btnCls} ${activeTab === 'quiz' ? 'bg-indigo-600 text-white shadow-md' : 'text-gray-500 hover:bg-gray-100'}`}>ğŸ† í€´ì¦ˆ</button>
                    </nav>

                    <main className="bg-white rounded-2xl shadow-xl p-5 w-full">
                        {activeTab === 'compare' && (
                            <section className="animate-fade-in">
                                <div className="grid grid-cols-2 gap-3 mb-6">
                                    <div className="p-4 bg-rose-50 rounded-2xl border-2 border-rose-100">
                                        <div className="font-extrabold text-rose-500 mb-3 text-center text-lg">ğŸ“˜ ì±… A</div>
                                        <input className={`${inputCls} mb-2`} placeholder="ì£¼ì œ (813.6)" value={inputA.class} onChange={e => setInputA({ ...inputA, class: e.target.value })} />
                                        <input className={`${inputCls} mb-2`} placeholder="ì €ì (ê¹€294)" value={inputA.author} onChange={e => setInputA({ ...inputA, author: e.target.value })} />
                                        <input className={inputCls} placeholder="ê¶Œì°¨ (v.1)" value={inputA.vol} onChange={e => setInputA({ ...inputA, vol: e.target.value })} />
                                    </div>
                                    <div className="p-4 bg-indigo-50 rounded-2xl border-2 border-indigo-100">
                                        <div className="font-extrabold text-indigo-500 mb-3 text-center text-lg">ğŸ“™ ì±… B</div>
                                        <input className={`${inputCls} mb-2`} placeholder="ì£¼ì œ (813.5)" value={inputB.class} onChange={e => setInputB({ ...inputB, class: e.target.value })} />
                                        <input className={`${inputCls} mb-2`} placeholder="ì €ì (ë‚˜15)" value={inputB.author} onChange={e => setInputB({ ...inputB, author: e.target.value })} />
                                        <input className={inputCls} placeholder="ê¶Œì°¨ (v.2)" value={inputB.vol} onChange={e => setInputB({ ...inputB, vol: e.target.value })} />
                                    </div>
                                </div>
                                <div className="flex gap-3 mb-6">
                                    <button onClick={handleCompare} className="flex-[3] py-4 bg-rose-500 text-white rounded-xl font-bold text-xl shadow-lg btn-press hover:bg-rose-600">âœ… ìˆœì„œ í™•ì¸!</button>
                                    <button onClick={clearInputs} className="flex-1 py-4 bg-gray-200 text-gray-600 rounded-xl font-bold text-xl shadow-md btn-press hover:bg-gray-300">ğŸ§¹</button>
                                </div>
                                {result.msg && (
                                    <div className="p-5 bg-yellow-50 rounded-2xl text-center border-2 border-yellow-400 shadow-sm">
                                        <p className="text-2xl font-black text-gray-800 mb-2">{result.msg}</p>
                                        {result.reason && <p className="text-sm text-gray-600 font-bold bg-white inline-block px-3 py-1 rounded-full border border-gray-200">{result.reason}</p>}
                                    </div>
                                )}
                            </section>
                        )}

                        {activeTab === 'rules' && (
                            <section className="space-y-5 animate-fade-in">
                                <div className="bg-blue-50 p-5 rounded-2xl border-l-8 border-blue-500 shadow-sm">
                                    <h3 className="font-extrabold text-xl text-blue-700 mb-2">ğŸ·ï¸ ì²­êµ¬ê¸°í˜¸ êµ¬ì¡°</h3>
                                    <p className="text-gray-700 font-medium text-lg">1ï¸âƒ£ <span className="text-red-600">813.6</span> (ì£¼ì œ) : ìˆ«ì í¬ê¸°<br/>2ï¸âƒ£ <span className="text-purple-600">ê¹€294</span> (ì €ì) : í•œê¸€/ìˆ«ì</p>
                                </div>
                                <div className="bg-green-50 p-5 rounded-2xl border-l-8 border-green-500 shadow-sm">
                                    <h3 className="font-extrabold text-xl text-green-700 mb-3">ğŸ”¤ í•œê¸€ ìˆœì„œ (ê°€ë‚˜ë‹¤)</h3>
                                    <div className="flex flex-wrap gap-1 mb-3">
                                        {KOREAN_CONSONANTS.map((c, i) => <span key={i} className="bg-white px-2 py-1 rounded-lg shadow-sm text-sm font-bold text-gray-700 border border-green-100">{c}</span>)}
                                    </div>
                                    <div className="flex flex-wrap gap-1">
                                        {KOREAN_VOWELS.map((v, i) => <span key={i} className="bg-white px-2 py-1 rounded-lg shadow-sm text-sm font-bold text-gray-700 border border-green-100">{v}</span>)}
                                    </div>
                                    <p className="mt-3 text-sm text-green-800 font-bold bg-green-100 inline-block px-2 rounded">ğŸ“Œ ë°›ì¹¨ ì—†ëŠ” ê¸€ìê°€ ë¨¼ì €!</p>
                                </div>
                                <div className="space-y-4">
                                    {KDC_RULES.map((rule, i) => (
                                        <div key={i} className="border-2 border-gray-100 rounded-2xl p-4 shadow-sm bg-white">
                                            <h3 className={`font-extrabold ${rule.color} text-lg mb-2`}>{rule.title}</h3>
                                            <p className="text-gray-700 mb-3 font-medium">{rule.explanation}</p>
                                            <div className="space-y-2">
                                                {rule.examples.map((ex, j) => (
                                                    <div key={j} className="bg-gray-50 p-3 rounded-xl text-sm border border-gray-200 flex justify-between items-center">
                                                        <span className="font-bold text-gray-800">{ex.title}</span>
                                                        <span className="text-gray-500 text-xs bg-white px-2 py-1 rounded border">{ex.note}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </section>
                        )}

                        {activeTab === 'quiz' && (
                            <section className="space-y-4 animate-fade-in">
                                <div className="bg-indigo-50 p-4 rounded-xl text-center mb-4 border border-indigo-100">
                                    <h2 className="text-xl font-extrabold text-indigo-700">ğŸ”¥ ì‹¤ë ¥ ê²€ì¦ í€´ì¦ˆ ğŸ”¥</h2>
                                    <p className="text-indigo-400 text-sm">í™”ì‚´í‘œ ë²„íŠ¼ìœ¼ë¡œ ìˆœì„œë¥¼ ë§ì¶°ë³´ì„¸ìš”!</p>
                                </div>
                                <div className="space-y-3">
                                    {quiz.map((item, i) => (
                                        <div key={item.id} className="flex items-center p-3 bg-white border-2 border-gray-100 rounded-2xl shadow-sm transition hover:border-indigo-300">
                                            <div className="w-10 h-10 bg-indigo-500 text-white rounded-full flex items-center justify-center font-bold mr-4 shrink-0 shadow-md text-lg">{i + 1}</div>
                                            <div className="font-mono text-lg leading-tight flex-1 text-gray-700">
                                                <span className="font-bold text-rose-500 mr-2">{item.class}</span>
                                                <span className="font-bold text-gray-800 mr-2">{item.author}</span>
                                                <span className="text-gray-400 text-base">{item.vol}</span>
                                            </div>
                                            {/* ëª¨ë°”ì¼ ì¹œí™”ì  ì´ë™ ë²„íŠ¼ ì¶”ê°€ */}
                                            <div className="flex flex-col gap-1 ml-2">
                                                <button onClick={() => moveItem(i, -1)} className="px-3 py-1 bg-gray-100 rounded-lg text-gray-600 hover:bg-gray-200 active:bg-gray-300 text-xs font-bold">â–²</button>
                                                <button onClick={() => moveItem(i, 1)} className="px-3 py-1 bg-gray-100 rounded-lg text-gray-600 hover:bg-gray-200 active:bg-gray-300 text-xs font-bold">â–¼</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-3 mt-6">
                                    <button onClick={generateNewQuiz} className="flex-1 py-4 bg-gray-200 rounded-xl font-bold text-gray-600 btn-press hover:bg-gray-300 shadow-md">ğŸ”„ ìƒˆ ë¬¸ì œ</button>
                                    <button onClick={handleSubmitQuiz} className="flex-[2] py-4 bg-indigo-600 text-white rounded-xl font-bold shadow-lg btn-press hover:bg-indigo-700 text-lg">ğŸŒŸ ì •ë‹µ í™•ì¸!</button>
                                </div>
                                {quizRes && (
                                    <div className={`p-5 rounded-2xl text-center border-4 mt-6 shadow-lg ${quizRes.ok ? 'bg-green-50 border-green-400' : 'bg-red-50 border-red-400'}`}>
                                        <p className={`text-2xl font-black mb-3 ${quizRes.ok ? 'text-green-600' : 'text-red-600'}`}>{quizRes.msg}</p>
                                        {!quizRes.ok && (
                                            <div className="text-left text-base bg-white p-4 rounded-xl mt-2 border-2 border-gray-100">
                                                <div className="font-extrabold text-red-500 mb-2 border-b pb-2">ğŸ‘‡ ì •ë‹µ ìˆœì„œ</div>
                                                {quizRes.ans.map((it, idx) => (
                                                    <div key={idx} className="font-mono py-1 flex items-center">
                                                        <span className="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-xs font-bold mr-2 text-gray-600">{idx + 1}</span>
                                                        {it.class} / {it.author} {it.vol}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}
                            </section>
                        )}
                    </main>
                    <footer className="text-center text-gray-400 text-xs mt-6 pb-2 w-full">
                        ë§Œë“  ì‚¬ëŒ ì˜ì•¤ì‹¬í”Œ
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
